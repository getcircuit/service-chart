{{ $namespace := .Values.namespace | default "apps" }}
{{ $svcHost := printf "%s.%s.svc.cluster.local" .Values.name $namespace }}
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: {{ .Values.name }}
  namespace: {{ $namespace }}
  labels:
    app.kubernetes.io/name: {{ .Values.name }}
spec:
  hosts:
  - {{ $svcHost }}
  {{- if .Values.public }}
  - {{ printf "%s.%s.%s" .Values.name .Values.cluster .Values.host }}
  {{- end }}
  gateways:
  - mesh
  - {{ printf "istio-system/%s" .Values.gateway }}
  http:
  - route:
    - destination:
        host: {{ $svcHost }}
        port:
          number: 80